<!DOCTYPE html>
<html>
    <head>
        <title>Game</title>
        <meta charset="UTF-8" />
        <link rel="stylesheet" type="text/css" href="../css/dragon.css" />
        <script type="text/javascript" src="../js/library/artist.js"></script>
    </head>

    <script>
        room['game'] = function () {
            DEBUG = false;
            sprite_load(`../img/dragon/bullet.png`, `bullet`);
            sprite_load(`../img/dragon/enemy_normal_01.png`, `enemy_normal_01`);
            sprite_load(`../img/dragon/bg.png`, `background`);
            sprite_load(`../img/dragon/player.png`, `player`);
            let score = 0;

            class background extends instance {
                constructor() {
                    super();
                }

                draw() {
                    this.y += 8;
                    if (this.y >= sprite_get_height(`background`)) {
                        this.y -= sprite_get_height(`background`);
                    }
                    draw_sprite_ext(this.x, this.y, `background`, 'left', 1, 1);
                    draw_sprite_ext(this.x, this.y - sprite_get_height(`background`), `background`, 'left', 1, 1);

                    draw_set_color(c_white);
                    draw_set_font(27, 'Arial');
                    draw_text_transformed(width / 2, 20, score, 'center');
                }
            }

            class player extends instance {
                constructor() {
                    super();
                }

                create() {
                    let self = this;
                    function create_bullet() {
                        setTimeout(() => {
                            instance_create(bullet, self.x, self.y, 3);
                            create_bullet();
                        }, 100);
                    }
                    create_bullet();
                }

                draw() {
                    this.y += (height - 60 - this.y) / 8;
                    this.x = mouse_x;
                    if (this.x < 0) {
                        this.x = 0;
                    }

                    if (this.x > width) {
                        this.x = width;
                    }
                    draw_sprite_ext(this.x, this.y, `player`, 'center', 1, 1);
                }
            }

            class bullet extends instance {
                constructor() {
                    super();
                }

                draw() {
                    this.y -= 10;
                    draw_sprite_ext(this.x, this.y, `bullet`, 'center', 1, 1);
                    if (this.y < 0) {
                        this.destroy();
                    }
                }
            }

            class monster extends instance {
                constructor() {
                    super();
                }

                draw() {
                    this.y += 7;
                    draw_sprite_ext(this.x, this.y, `enemy_normal_01`, 'center', 1, 1);

                    if (this.y > height + 50) {
                        this.destroy();
                    }
                }
            }

            instance_create(background, 0, 0, 1);
            instance_create(player, mouse_x, height + 100, 4);

            function create_monster() {
                setTimeout(() => {
                    instance_create(monster, width / 2, -100, 2);
                    instance_create(monster, width / 2 - 120, -100, 2);
                    instance_create(monster, width / 2 + 120, -100, 2);
                    create_monster();
                }, 2000);
            }
            create_monster();
        };

        room_goto('game');
    </script>

    <body>
        <h1>안녕하세요 반갑습니다</h1>
        <canvas id="canvas" width="384" height="512" style="border: 1px solid #000000;"> </canvas>
    </body>
</html>
